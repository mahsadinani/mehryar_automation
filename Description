# پرامپت جامع  : طراحی و پیاده‌سازی سیستم مدیریت فرآیندهای آموزشی و مالی

**هدف:** طراحی و پیاده‌سازی یک اپلیکیشن تحت وب جامع برای مدیریت فرآیندهای آموزشی (شامل ثبت‌نام، مدیریت کلاس‌ها) و فرآیندهای مالی مرتبط با آن، با تمرکز بر اتوماسیون و یکپارچه‌سازی با ابزارهای خارجی (مانند Google Sheets و Google Calendar).

## ۱. فرآیندهای اصلی و ویژگی‌های مورد نیاز

سیستم باید حداقل شامل پنج فرآیند اصلی زیر باشد که هر یک دارای اهداف و نیازمندی‌های مشخصی هستند:

### ۱.۱. فرآیند اول: مدیریت فرم‌های ورودی (متقاضیان)

**هدف:** مدیریت یکپارچه اطلاعات اولیه متقاضیان، تسهیل اطلاع‌رسانی دوره‌ها و پیگیری متقاضیان قدیمی.

| ویژگی | توضیحات |
| :--- | :--- |
| **فرم ورودی** | طراحی یک فرم ورودی کاربرپسند (UI) برای متقاضیان و کارمندان. |
| **ساختار داده** | قابلیت تعریف و استفاده از فرمت داده ورودی در قالب **Excel** (به عنوان الگوی اولیه). |
| **اتصال به Google Calendar** | اتصال به Google Calendar برای اطلاع‌رسانی خودکار در مورد زمان‌بندی کلاس‌های آینده. |
| **پیام خوش‌آمدگویی** | تعریف و ارسال خودکار پیام خوش‌آمدگویی و اطلاع‌رسانی اولیه. |

### ۱.۲. فرآیند دوم: پیش‌ثبت‌نام اولیه

**هدف:** دریافت اطلاعات کامل‌تر و دریافت هزینه پیش‌ثبت‌نام از طریق درگاه پرداخت.

| ویژگی | توضیحات |
| :--- | :--- |
| **دریافت اطلاعات کامل** | دریافت کلیه اطلاعات مورد نیاز فرد از طریق فرم پیش‌ثبت‌نام (لینک فرم در سایت قرار دارد). |
| **درگاه پرداخت** | انتقال کاربر به درگاه پرداخت پس از تکمیل فرم برای دریافت هزینه پیش‌ثبت‌نام. |
| **تکمیل خودکار فرم‌ها** | تکمیل خودکار اطلاعات در سایر فرم‌های مرتبط (در صورت وجود) پس از اتمام موفقیت‌آمیز این فرآیند. |

### ۱.۳. فرآیند سوم: مدیریت کلاس‌ها

**هدف:** ایجاد و به‌روزرسانی لیست حضور و غیاب، مدیریت یکپارچه مالی هنرجویان و محاسبه خودکار جلسات.

| ویژگی | توضیحات |
| :--- | :--- |
| **لیست حضور و غیاب** | ایجاد و به‌روزرسانی لیست حضور افراد در کلاس. |
| **ثبت حضور و غیاب** | امکان افزودن لیست حضور و غیاب به سیستم. |
| **مدیریت مالی یکپارچه** | مدیریت یکپارچه حساب‌های مالی هر هنرجو با استفاده از **فرم مالی** (اتصال به فرآیند چهارم). |
| **محاسبه خودکار جلسات** | محاسبه خودکار تعداد جلسات باقی‌مانده و جلسات اضافه شده. |
| **جابجایی کلاس‌ها** | امکان جابجایی کلاس‌ها به صورت دستی در لحظه از طریق **Google Calendar**. |

### ۱.۴. فرآیند چهارم: مدیریت امور مالی

**هدف:** اتوماسیون ثبت تراکنش‌های مالی، به‌روزرسانی وضعیت شهریه و هوشمندسازی پیام‌های اقساط.

| ویژگی | توضیحات |
| :--- | :--- |
| **اتوماسیون ثبت تراکنش** | ثبت خودکار تراکنش‌های مالی. |
| **به‌روزرسانی وضعیت شهریه** | به‌روزرسانی خودکار وضعیت شهریه در سایر فرم‌ها. |
| **هوشمندسازی پیام‌های اقساط** | ارسال هوشمند پیام‌های اقساط (تعیین مدت زمان از ابتدا تا انتهای دوره). |
| **اعمال تخفیف** | امکان اعمال تخفیف شهریه در صورت لزوم. |

### ۱.۵. فرآیند پنجم: مدیریت ورودی‌های وب‌سایت

**هدف:** تسریع در افزودن ورودی‌های وب‌سایت به لیست پیگیری و بهبود ردیابی آن‌ها.

| ویژگی | توضیحات |
| :--- | :--- |
| **افزودن سریع به لیست پیگیری** | افزودن سریع ورودی‌های وب‌سایت به لیست پیگیری. |
| **ردیابی بهتر** | بهبود فرآیند ردیابی ورودی‌های وب‌سایت. |
| **اطلاع‌رسانی کارمندان** | اطلاع‌رسانی فوری به کارمندان به محض ثبت ورودی جدید در سایت. |

## ۲. ساختار داده و یکپارچه‌سازی (Back-end & Data Structure)

**نکته کلیدی:** دیتابیس اصلی سیستم باید بر پایه **Google Sheets** باشد.

| بخش | توضیحات |
| :--- | :--- |
| **دیتابیس اصلی** | دیتابیس‌های اصلی سیستم **فقط** باید Google Sheets باشند. |
| **فرم‌های اطلاعاتی** | هر یک از موارد زیر باید یک Google Sheet مجزا باشند که به عنوان دیتابیس عمل می‌کنند: `فرم مشتریان`، `لیست شاگردان`، `فرم مالی`، `مدرسین`، `پیام‌های آماده`، `دوره‌های آموزشی`، `دوره‌های فنی`، `کلاس‌ها`. |
| **مدیریت نسخه‌ها** | از آنجایی که ممکن است فرم‌ها و دیتابیس‌ها سالانه تغییر کنند یا نسخه‌های متعددی داشته باشند، سیستم باید یک **لیست باکس (List Box)** داشته باشد. |
| **عملکرد لیست باکس** | این لیست باکس باید لینک Google Sheet مربوط به هر فرم را دریافت کند و سپس اطلاعات آن را در فرم‌های اصلی سیستم (که با آن کار می‌کند) **واکشی (Fetch)** کند. |
| **انعطاف‌پذیری** | این قابلیت انعطاف‌پذیری را فراهم می‌کند که سیستم بتواند با نسخه‌های مختلف فرم‌ها در سال‌های مختلف کار کند. |

## ۳. خروجی مورد انتظار (پرامپت نهایی)

**، یک پرامپت جامع برای طراحی و پیاده‌سازی یک اپلیکیشن تحت وب با مشخصات زیر بنویسید:**

۱. **نام پروژه:** سیستم مدیریت فرآیندهای آموزشی و مالی (LMS/Finance Automation)
۲. **معماری:** یک اپلیکیشن تحت وب (Web Application)
۳. **دیتابیس:** **Google Sheets** به عنوان دیتابیس اصلی (Single Source of Truth)
۴. **یکپارچه‌سازی‌های کلیدی:** Google Calendar، درگاه پرداخت (Payment Gateway)
۵. **تمرکز اصلی:** اتوماسیون فرآیندهای پنج‌گانه (مدیریت متقاضیان، پیش‌ثبت‌نام، مدیریت کلاس، مدیریت مالی، مدیریت ورودی‌های سایت)
۶. **ویژگی‌های حیاتی:**
    * **ماژول مدیریت داده:** قابلیت تعریف و واکشی داده از لینک‌های مختلف Google Sheet از طریق یک لیست باکس برای هر فرم (مانند فرم مالی، لیست شاگردان و...).
    * **اتوماسیون مالی:** ثبت خودکار تراکنش، به‌روزرسانی وضعیت شهریه، ارسال هوشمند پیام‌های اقساط.
    * **اتوماسیون کلاس:** محاسبه خودکار جلسات باقی‌مانده/اضافه، یکپارچگی با Google Calendar برای جابجایی کلاس‌ها.
    * **تجربه کاربری:** طراحی UI/UX مناسب برای فرم‌های ورودی متقاضیان و کارمندان.

**نکته:** در پرامپت، بر اهمیت **Google Sheets** به عنوان تنها دیتابیس اصلی و نیاز به مکانیزم **واکشی داده از لینک‌های متغیر Google Sheet** تاکید کنید.

## پرامپت نهایی برای 

، لطفاً یک اپلیکیشن تحت وب کامل برای «سیستم مدیریت فرآیندهای آموزشی و مالی (LMS/Finance Automation)» طراحی و پیاده‌سازی کن که مشخصات و محدودیت‌های زیر را دقیقاً رعایت کند:

- نام پروژه: سیستم مدیریت فرآیندهای آموزشی و مالی (LMS/Finance Automation)
- معماری: وب اپلیکیشن با لایه‌های Frontend و Backend و یکپارچه‌سازی با سرویس‌های خارجی
- دیتابیس: فقط Google Sheets به‌عنوان Single Source of Truth (هیچ دیتابیس دیگری مجاز نیست)
- یکپارچه‌سازی‌ها: Google Calendar برای مدیریت و جابجایی کلاس‌ها، درگاه پرداخت منتخب برای پیش‌ثبت‌نام و تراکنش‌ها
- تمرکز اصلی: اتوماسیون پنج فرآیند کلیدی (مدیریت متقاضیان، پیش‌ثبت‌نام، مدیریت کلاس‌ها، مدیریت مالی، مدیریت ورودی‌های سایت)

### الزام‌های Google Sheets (تنها دیتابیس)
- برای هر فرم/موجودیت، یک Google Sheet مجزا استفاده کن: `فرم مشتریان`، `لیست شاگردان`، `فرم مالی`، `مدرسین`، `پیام‌های آماده`، `دوره‌های آموزشی`، `دوره‌های فنی`، `کلاس‌ها`.
- یک «List Box» مدیریتی پیاده‌سازی کن که لینک Google Sheet هر فرم را می‌گیرد و داده‌های فعال سیستم را از همان لینک «واکشی» می‌کند. این مکانیزم باید امکان انتخاب نسخه‌های مختلف سالانه را بدهد.
- دسترسی و عملیات Sheets باید شامل: OAuth 2.0، خواندن/نوشتن سطرها، نگاشت ایمن ستون‌ها، کنترل همزمانی (optimistic concurrency)، و گزارش خطا باشد.
- الگوهای ستون‌ها و سطرها را به‌صورت قابل‌پیکربندی نگه‌دار تا با تغییر نسخه‌ها سازگار باشد.

### ماژول‌ها و صفحات اصلی
- مدیریت فرم‌های ورودی (متقاضیان): فرم کاربرپسند برای ثبت اطلاعات اولیه متقاضیان و کارمندان؛ اتصال به Google Calendar جهت اطلاع‌رسانی زمان‌بندی کلاس‌های آینده؛ ارسال پیام خوش‌آمدگویی.
- پیش‌ثبت‌نام: دریافت اطلاعات تکمیلی؛ انتقال به درگاه پرداخت؛ پس از موفقیت پرداخت، تکمیل خودکار فرم‌های مرتبط در Sheets.
- مدیریت کلاس‌ها: ساخت و بروزرسانی لیست حضور و غیاب؛ محاسبه خودکار جلسات باقی‌مانده/اضافه؛ امکان جابجایی دستی کلاس‌ها از طریق Google Calendar و همگام‌سازی با سیستم.
- مدیریت مالی: ثبت خودکار تراکنش‌ها؛ بروزرسانی وضعیت شهریه در سایر فرم‌ها؛ ارسال هوشمند پیام‌های اقساط با توجه به بازه دوره؛ امکان اعمال تخفیف.
- مدیریت ورودی‌های وب‌سایت: افزودن سریع ورودی‌های سایت به لیست پیگیری؛ ردیابی بهتر؛ اطلاع‌رسانی فوری به کارمندان.
- ماژول مدیریت داده (List Box): صفحه مدیریتی برای ثبت/ویرایش لینک‌های Google Sheet هر فرم، انتخاب نسخه فعال و واکشی/همگام‌سازی داده‌ها.

### یکپارچه‌سازی با Google Calendar
- ایجاد/ویرایش/حذف رویدادهای کلاس‌ها؛ نگه‌داشت شناسه رویداد در Sheet مربوطه.
- جابجایی دستی کلاس در Calendar باید در سیستم بازتاب پیدا کند (Sync دوطرفه یا Pull دوره‌ای).
- نمایش تقویم کلاس‌ها در UI و امکان فیلتر بر اساس دوره/مدرس/کلاس.

### یکپارچه‌سازی درگاه پرداخت
- پس از تکمیل فرم پیش‌ثبت‌نام، کاربر به درگاه پرداخت هدایت شود.
- دریافت وبهوک وضعیت تراکنش (موفق/ناموفق/لغو) و ثبت در `فرم مالی`، سپس بروزرسانی وضعیت در فرم‌های دیگر.
- مدیریت شناسه تراکنش و تطبیق با کاربر/دوره مربوطه.

### فلوهای خودکار و قوانین کسب‌وکار
- Auto-fill: پس از موفقیت پیش‌ثبت‌نام، اطلاعات در فرم‌های مرتبط (شاگردان/مالی/کلاس‌ها) تکمیل و مرتبط‌سازی شود.
- Attendance: ثبت حضور/غیاب و بروزرسانی جلسات باقی‌مانده؛ محاسبه خودکار بر اساس قواعد هر دوره.
- Tuition: بروزرسانی وضعیت شهریه با هر تراکنش؛ اعمال تخفیف؛ محاسبه اقساط و برنامه پیام‌ها.
- Messaging: ارسال پیام‌های خوش‌آمد و اقساط بر اساس `پیام‌های آماده`؛ کانال ارسال را قابل‌پیکربندی نگه‌دار.

### UI/UX و صفحات نمونه
- `ApplicantsForm`، `PreRegistrationForm`، `ClassesDashboard`، `FinanceDashboard`، `WebsiteLeads`، `DataLinksManager (List Box)`، `Teachers`, `Courses`, `TechnicalCourses`.
- فیلترها، جستجو، و وضعیت‌های واضح (Loading/Error/Empty)؛ اعتبارسنجی فرم‌ها؛ نوتیفیکیشن‌ها.

### امنیت و تنظیمات
- همه کلیدها و اسرار (Google OAuth، Payment) از طریق `ENV` تأمین شوند و در کد لاگ نشوند.
- هندلینگ خطا و ریت‌لیمیت APIها رعایت شود.

### خروجی و ملاک‌های پذیرش
- کد کامل Frontend/Backend با یکپارچه‌سازی‌های مذکور؛ صفحات و ماژول‌های فهرست‌شده.
- پیاده‌سازی List Box برای انتخاب لینک‌های Sheets و واکشی/همگام‌سازی داده.
- فلوهای پرداخت، تقویم کلاس‌ها، حضور/غیاب، و اتوماسیون مالی کار کنند و در Sheets ثبت شوند.
- راه‌اندازی محلی با ENV نمونه و مستندات مختصر راه‌اندازی.

روی «Google Sheets به‌عنوان تنها دیتابیس و مکانیزم List Box برای واکشی از لینک‌های متغیر» تأکید ویژه داشته باش.
